---
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";
import { SITE_CONFIG } from "../config";
import { formatDate } from "../utils/dates";
import { calculateReadingTime } from "../utils/misc";
import type { Post } from "../types";

const allPosts = await getCollection("posts");
---

<Layout title={SITE_CONFIG.title}>
  <main>
    {
      allPosts
        .filter((post: Post) => !post.data.draft)
        .map((post: Post) => {
          const href = "/blog/" + post.id;
          const date = new Date(post.data.date);
          const formattedDate = formatDate(date);
          const readingTime = calculateReadingTime(post.body || "");
          const excerpt = post.data.excerpt;

          return (
            <div class="flex flex-col mb-8">
              <a
                id="post-title"
                class="hover:underline hover:text-[#424949] dark:text-[#d1d5db] dark:hover:text-white"
                href={href}
              >
                {post.data.title}
              </a>
              <a id="post-date" class="mt-1">
                {formattedDate} -
                <span id="reading-time" class="ml-1">
                  {readingTime} m read
                </span>
              </a>
              {excerpt && (
                <div id="post-preview" class="mt-4">
                  {excerpt}
                </div>
              )}
            </div>
          );
        })
    }
  </main>
</Layout>

<style>
  nav #logo {
    font-family: var(--font-pixel);
    font-size: 36px;
  }

  nav #right-navbar a {
    font-family: var(--font-atkinson);
    font-size: 24px;
    font-weight: regular;
  }

  #post-title {
    font-family: var(--font-merriweather);
    font-size: 22px;
    line-height: 1.3;
  }

  :global(html:not(.dark) #post-title) {
    color: #000000;
  }

  :global(html:not(.dark) #post-title:visited) {
    color: #000000;
  }

  @media (min-width: 640px) {
    #post-title {
      font-size: 24px;
    }
  }

  #post-date {
    font-family: var(--font-atkinson);
    font-size: 14px;
    font-weight: 400;
    color: var(--color-text-muted);
  }

  #post-preview {
    font-family: var(--font-atkinson);
    font-size: 15px;
    max-width: none;
    overflow-wrap: break-word;
    line-height: 1.5;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  #post-preview :global(code) {
    font-family: var(--font-mono);
  }

  #post-preview :global(pre code) {
    font-family: var(--font-mono);
  }

  @media (min-width: 640px) {
    #post-preview {
      -webkit-line-clamp: 4;
    }
  }
</style>
