---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import type { CollectionEntry } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import Navbar from "../../components/Navbar.astro";

// TODO: This should be a global setting that is set by the user
const isDarkTheme = false;

interface Props {
	post: CollectionEntry<"posts">;
}

export async function getStaticPaths() {
	const blogPosts = await getCollection("posts");
	return blogPosts.map((post) => ({
		params: { slug: post.slug },
		props: { post },
	}));
}

const { post } = Astro.props;
const { Content } = await post.render();
const hasImage = post.data.cover;

const formattedDate = new Date(post.data.date).toLocaleDateString("en-US", {
	year: "numeric",
	month: "short",
	day: "numeric",
});
---

<div class="max-w-3xl mx-auto">
	<Navbar />
	<Layout title={post.data.title} isDarkTheme={isDarkTheme}>
		<div
			class="flex flex-col items-center justify-center min-h-screen mt-8"
		>
			<article
				class={`prose ${isDarkTheme ? "dark:prose-invert" : "prose-stone"}`}
			>
				{
					hasImage && (
						<Image
							class="object-cover object-center !m-0 aspect-square block"
							src={post.data.cover}
							alt={post.data.title}
							width={600}
							height={600}
						/>
					)
				}
				<h1 id="title" class="mb-3">
					{post.data.title}
				</h1>
				<a id="post-date">
					{formattedDate}
				</a>
				<!-- <p class="lead">{post.data.excerpt}</p> -->
				<div>
					<Content />
				</div>
			</article>
		</div>
	</Layout>
</div>

<style>
	#title {
		font-family: "Noto Serif Georgia";
		font-size: 26px;
	}

	#post-date {
		font-family: "IBM Plex Mono", monospace;
		font-size: 14px;
		color: #929292;
		text-decoration: none;
	}

	#post-preview {
		font-family: "IBM Plex Mono", monospace;
		font-size: 14px;
	}

	.prose {
		font-family: "IBM Plex Mono", monospace;
		font-size: 14px;
	}

	.prose:where(h2) {
		font-weight: 100;
	}

	pre {
		border: 5px solid red;
	}
</style>
